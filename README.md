# Bio Wearable Project Example

# Introduction
This project is an example of how Extra Horizon can be used to create a bio wearable project.
It contains the bare minimal code required to show case what's needed to get started.

# Project Overview
- A device (represented by a node.js script) performs measurements.
- The raw signal is sent to the File Service.
- The metadata and file reference is sent to the Data Service.
- The Data Service triggers a task to analyze the measurement.
- The task sends an email if the heart rate is above a certain threshold.

# Instructions

## Prerequisites
1. [Install the Extra Horizon CLI](https://docs.extrahorizon.com/cli/readme/installation)
2. [Login to the CLI](https://docs.extrahorizon.com/cli/readme/login)
3. Validate you're authenticated correctly
    ```bash
    exh whoami
    ```

## Setup
4. Install dependencies for the task
    ```bash
    cd tasks/process-bio-measurement
    npm install
    cd ../..
    ```
5. Sync the project using the CLI
    ```bash
    exh sync
    # It should say something like:
    # ⚙️ Syncing schemas ...
    # ⚙️ Syncing templates ...
    # ⚙️ Syncing tasks ...
    ```


## Run the script
6. Install the dependencies for the script
    ```bash
    cd demo-measurement-script
    npm install
    ```
7. Create a `.env` file with your credentials
    ```bash
    cp .env.example .env
    # Edit the .env file
    # Credentials are either provided to you or:
    # - Generate credentials yourself using the Control Center
    # - Find the credentials generated by the CLI by opening the `.exh/credentials` file in your home directory
    ```
8. Run the script
    ```bash
    node index.js
    # It should say something like:
    # Created measurement "674dc71af2f3225fc801efbc" with heart rate 165, heart rate variability 91, and temperature 36
    ```
9. If the heart rate is above 120, an email will be sent. Run as many times as you want and check your email.
10. Move back to the root directory
    ```bash
    cd ..
    ```

## Run the web app
11. Install the dependencies for the web app
    ```bash
    cd demo-web-app
    npm install
    ```
12. Create a `.env` file with your credentials
    ```bash
    cp .env.example .env
    # Edit the .env file
    # Credentials are either provided to you or:
    # - Generate credentials yourself using the Control Center
    # - Find the credentials generated by the CLI by opening the `.exh/credentials` file in your home directory
    ```
13. Run the web app
    ```bash
    npm start
    ```
14. Open your browser and go to http://localhost:3000 to view the measurements

# Folder Structure
- `demo-measurement-script/`
  - A node.js script simulating a device sending data to ExH
- `demo-web-app/`
  - A web app that displays the data from ExH
- 3 folders containing the configuration for ExH, used by the CLI to configure a ExH cluster
  - `schemas/bio-measurement.json`
    - Data service schema describing the Bio Measurement schema
  - `tasks/process-bio-measurement/`
    - A function "analyzing" measurements and sending out an email
  - `templates/heart-rate-alert-email/`
    - A template for the email

